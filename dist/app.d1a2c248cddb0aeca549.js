webpackJsonp([0],[function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var n=i(2),o=(a(n),i(3)),s=a(o),r=i(4),l=a(r),u=i(9),c=a(u);i(27),function(){var e=document.getElementById("scene"),t=function(){var t=document.body.clientWidth/320,i=document.body.clientHeight/640;document.documentElement.style.fontSize=16*t+"px",s.default.set("global-ratio-x",t),s.default.set("global-ratio-y",i);var n=document.body.clientWidth,o=document.body.clientHeight,r=window.devicePixelRatio||1;e.width=n*r,e.height=o*r;var u=function(e){var t={};t.step=e.step,t.food=e.food,t.total=e.total,alert(JSON.stringify(t))},c=function(){alert("开启游戏异常")};l.default.game_state&&l.default.resetSceneCanvas(),l.default.start(e,u,c),a&&a()};window.addEventListener("resize",t),t();var i=function(){180!=window.orientation&&0!=window.orientation||(document.getElementById("tipPage").style.display="none"),90!=window.orientation&&window.orientation!=-90||(document.getElementById("tipPage").style.display="block")};"onorientationchange"in window&&window.addEventListener("orientationchange",i,!1);var a=function(){if(document.getElementById("bgm-music")){var e=document.getElementById("bgm-music");e.play()}else{var t=document.createElement("audio");t.setAttribute("id","bgm-music"),t.setAttribute("src",c.default.filePath+"assets/audio/bgm.mp3"),t.setAttribute("autoplay","autoplay"),t.setAttribute("loop","loop"),t.play(),document.body.appendChild(t)}};a(),/android/i.test(window.navigator.userAgent)&&document.addEventListener("visibilitychange",function(){function e(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}function t(){var t=e();return!!t&&document[t]}if(t()){var i=document.getElementById("bgm-music");i&&i.pause()}else{var a=document.getElementById("bgm-music");a&&a.play()}})}()},function(e,t){e.exports=jUtils},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={_map:{},has:function(e){return!!i._map[e.toString()]},get:function(e){return i._map[e.toString()]},set:function(e,t){return i._map[e.toString()]=t}};t.default=i},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),o=a(n),s=i(5),r=a(s),l=i(8),u=a(l),c=i(10),h=a(c),d=i(13),f=a(d),m=i(14),p=a(m),_=i(15),g=a(_),v=i(17),y=a(v),P=i(18),E=a(P),w=i(3),b=a(w),S=i(9),k=a(S);i(19);var T={sceneCanvas:void 0,game_state:!1,move_state:!1,gameScene:void 0,mapRender:void 0,roleRender:void 0,coinRender:void 0,currentMoveInfo:void 0,currentMovePercent:void 0,gameOverCallback:function(){},gameErrorCallback:function(){},start:function(e,t,i){window.location.hash="game",T.game_state=!1,T.move_state=!1,T.sceneCanvas=e,t&&"function"==typeof t&&(T.gameOverCallback=t),i&&"function"==typeof i&&(T.gameErrorCallback=i);var a=document.getElementById("page");o.default.addClass(a,"hide");var n=document.querySelector(".game-container");o.default.removeClass(n,"hide"),T.showLoading(!0),T.showGame(!1);var s=(new Date).getTime();b.default.set("game-score",{base:k.default.base_score,food:k.default.coin,move:k.default.move,startTime:s,endTime:s,lastFoodType:""}),T.refreshGameInfo();var r='<div class="loading-txt">正在准备游戏数据...</div>\n                            <div class="loading-progress">\n                                <div class="loading-loaded">\n                            </div>\n                        </div>',l=document.querySelector(".game-container .game-loading");l.innerHTML=r;var u=document.querySelector(".game-container .game-notice .refresh");if(u.onclick=T.refreshGameNotice,k.default.random){b.default.set("map-info",{mapID:0});var c=k.default.random_resource;T.loadResource(c,function(){var e='<div class="loading-txt">正在初始化游戏...</div>\n                                    <div class="loading-progress">\n                                        <div class="loading-loaded" style="width: 100%;">\n                                    </div>\n                                </div>',t=document.querySelector(".game-container .game-loading");t.innerHTML=e,T.drawScene(),setTimeout(function(){T.showLoading(!1),T.showGame(!0)},500)})}else{var h=function(e){for(var t=T.parseMapData(e),i=[],a=0;a<t.sourceList.length;a++)i.push(k.default.filePath+"assets/images/game/"+t.sourceList[a]+".png");T.loadResource(i,function(){var e='<div class="loading-txt">正在初始化游戏...</div>\n                                        <div class="loading-progress">\n                                            <div class="loading-loaded" style="width: 100%;">\n                                        </div>\n                                    </div>',i=document.querySelector(".game-container .game-loading");i.innerHTML=e,T.drawScene(t.mapData),setTimeout(function(){T.showLoading(!1),T.showGame(!0)},500)})},d=function(){T.gameErrorCallback()};k.default.localtest?o.default.ajax({method:"get",url:k.default.filePath+"assets/game.json",dataType:"json",success:function(e){h(e),b.default.set("map-info",{mapID:0}),T.refreshGameNotice()},error:d}):o.default.ajax({method:"get",url:k.default.remoteURL+"/hellobc/map",dataType:"json",success:function(e){if(console.log(e),200===e.httpStatusCode){var t=e.data.map.this_week;if(!t||void 0===t.wxgame_map_id||void 0===t.map_content)return void T.gameErrorCallback();h(JSON.parse(t.map_content)),b.default.set("map-info",{mapID:t.wxgame_map_id}),T.refreshGameNotice()}else T.gameErrorCallback()},error:d})}},loadResource:function(e,t){b.default.has("assets-cache")||b.default.set("assets-cache",{});var i=b.default.get("assets-cache"),a=k.default.resource.concat(e),n=new E.default(a);n.load(function(e){var a=Math.round(100*e.loadedCount/e.totalCount),n='<div class="loading-txt">正在加载游戏资源...'+a+'%</div>\n                                <div class="loading-progress">\n                                    <div class="loading-loaded" style="width: '+a+'%;">\n                                </div>\n                            </div>',o=document.querySelector(".game-container .game-loading");o.innerHTML=n;for(var s=0;s<e.loadedList.length;s++){var r=e.loadedList[s];i[r.url]={url:r.url,assets:r.assets}}e.complete&&t()})},drawScene:function(e){T.game_state=!0;var t=b.default.get("assets-cache")[k.default.filePath+"assets/audio/qmove.mp3"].assets,i=b.default.get("assets-cache")[k.default.filePath+"assets/audio/qeat.mp3"].assets,a=new r.default({mapSize:k.default.mapSize,blockCount:k.default.blockCount,coinCount:k.default.coinCount,startPosition:k.default.startPosition,startDirection:k.default.startDirection,endPosition:k.default.endPosition,mapData:e});T.gameScene=a,T.currentMoveInfo={position:k.default.startPosition,direction:k.default.startDirection},T.currentMovePercent=1,T.clearSceneCanvas();var n=T.sceneCanvas.width,s=T.sceneCanvas.height,l=T.makeCenterCube(.7*n,100,n,s),c=new u.default({canvas:T.sceneCanvas,topPoints:l,mapSize:k.default.mapSize,mapData:a.mapData,endPosition:k.default.endPosition});c.render(),T.mapRender=c;var d=new f.default({canvas:T.sceneCanvas,topPoints:l,mapSize:k.default.mapSize});d.render(a.mapData,k.default.startPosition,"up"),T.coinRender=d;var m=new h.default({canvas:T.sceneCanvas,topPoints:l,mapSize:k.default.mapSize,startPosition:k.default.startPosition,startDirection:k.default.startDirection});m.render(),T.roleRender=m,d.render(a.mapData,k.default.startPosition,"down");var p=function(e,t){var i=10,n=0,s=0,r=0,l=function l(u){if(0===r)r=u,T.clearSceneCanvas(),c.render(),d.render(a.mapData,e.position,"up"),m.render(0,e.position,e.direction),d.render(a.mapData,e.position,"down"),T.currentMoveInfo=e,T.currentMovePercent=0;else if(u-r>20)if(r=u,n+=1,n>i){var h=document.querySelector(".operate-container .operate-able");o.default.removeClass(h,"hide");var f=document.querySelector(".operate-container .operate-disable");o.default.addClass(f,"hide"),T.currentMoveInfo=e,T.currentMovePercent=1,t()}else T.clearSceneCanvas(),c.render(),d.render(a.mapData,e.position,"up"),m.render(n/i,e.position,e.direction),d.render(a.mapData,e.position,"down"),T.currentMoveInfo=e,T.currentMovePercent=n/i;n<=i&&(s=o.default.requestAnimFrame.call(null,l))};s=o.default.requestAnimFrame.call(null,l)},_=document.querySelector(".operate-container .operate-able .move");_.onclick=function(){var e=function e(){var n=a.roleMoveForward();if(n&&n.moved){T.move_state=!0;var s=document.querySelector(".operate-container .operate-able");o.default.addClass(s,"hide");var r=document.querySelector(".operate-container .operate-disable");o.default.removeClass(r,"hide"),p(n,e);var l=b.default.get("game-score");l.move+=1;var u=!1,h=void 0;if(n.coined){var f=k.default.mapSize,_=a.mapData[n.position[0]*f[1]+n.position[1]];h=d.getCoinCoord(n.position),_.coined||(_.coined=!0,i.volume=.8,i.currentTime=0,i.play(),u=!0,l.lastFoodType&&_.coinType===l.lastFoodType?l.food*=2:(l.food+=1,l.lastFoodType=_.coinType))}else t.volume=.8,t.currentTime=0,t.play();T.refreshGameInfo(u,h),n.ended&&setTimeout(function(){T.game_state=!1,T.gameScene=void 0,T.mapRender=void 0,T.roleRender=void 0,T.coinRender=void 0,T.currentMoveInfo=void 0,T.currentMovePercent=void 0;var e=b.default.get("game-score");e.endTime=(new Date).getTime();var t=(Math.floor(.001*(e.endTime-e.startTime)),e.base+e.food-e.move),i=b.default.get("map-info");T.gameOverCallback({map_id:i.mapID,step:e.move,food:e.food,time:e.endTime-e.startTime,total:t<0?0:t})},1e3)}else n&&!n.moved&&(T.move_state=!1,T.clearSceneCanvas(),c.render(),d.render(a.mapData,n.position,"up"),m.render(-1,n.position,n.direction),d.render(a.mapData,n.position,"down"))};e()};var g=document.querySelector(".operate-container .operate-able .left");g.onclick=function(){if(!T.move_state){var e=a.roleTurnLeft();e&&(t.play(),T.clearSceneCanvas(),c.render(),d.render(a.mapData,e.position,"up"),m.render(1,e.position,e.direction),d.render(a.mapData,e.position,"down"),T.currentMoveInfo=e,T.currentMovePercent=1)}};var v=document.querySelector(".operate-container .operate-able .right");v.onclick=function(){if(!T.move_state){var e=a.roleTurnRight();e&&(t.play(),T.clearSceneCanvas(),c.render(),d.render(a.mapData,e.position,"up"),m.render(1,e.position,e.direction),d.render(a.mapData,e.position,"down"),T.currentMoveInfo=e,T.currentMovePercent=1)}}},makeCenterCube:function(e,t,i,a){var n=i,o=a,s=e,r=t,l=.2*-Math.PI,u=.25*-Math.PI,c=0,h=[[1,0,0],[0,Math.cos(l),-Math.sin(l)],[0,Math.sin(l),Math.cos(l)]],d=[[Math.cos(u),0,Math.sin(u)],[0,1,0],[-Math.sin(u),0,Math.cos(u)]],f=y.default.multiply(d,y.default.multiply(h,[[0],[0],[1]])),m=.5*(n+s)-.5*o*f[0][0]/f[1][0],_=.5*-o*f[2][0]/f[1][0],v=[new p.default(.5*(n-s),.5*o,0),new p.default(.5*(n+s),.5*o,0),new p.default(.5*(n+s),.5*o+r,0),new p.default(.5*(n-s),.5*o+r,0),new p.default(.5*(n-s),.5*o,s),new p.default(.5*(n+s),.5*o,s),new p.default(.5*(n+s),.5*o+r,s),new p.default(.5*(n-s),.5*o+r,s)],P=new g.default(new p.default(m,0,_),new p.default(l,u,c));return P.projectPoints(v)},clearSceneCanvas:function(){var e=T.sceneCanvas.getContext("2d");e.clearRect(0,0,T.sceneCanvas.width,T.sceneCanvas.height)},resetSceneCanvas:function(){T.clearSceneCanvas(),T.mapRender.render(),T.coinRender.render(T.gameScene.mapData,T.currentMoveInfo.position,"up");var e=T.currentMoveInfo;T.roleRender.render(T.currentMovePercent,e.position,e.direction),T.coinRender.render(T.gameScene.mapData,T.currentMoveInfo.position,"down")},parseMapData:function(e){var t=[],i=[],a=function(e){var t=new RegExp("^"+k.default.mapType+"_","i"),i=new RegExp("^"+k.default.coinType+"_","i"),a=new RegExp("^"+k.default.startType+"$","i");return t.test(e)?"normal":i.test(e)?"coin":a.test(e)?"start":""};if(e.layers.length>0){for(var n=e.layers[0].data,s={},r="",l=0;l<e.tilesets.length;l++){var u=e.tilesets[l],c=a(u.name);c&&(s["mc"+u.firstgid]={},s["mc"+u.firstgid].type=c,s["mc"+u.firstgid].editable=!1,"coin"===c?(s["mc"+u.firstgid].coinType=u.name,s["mc"+u.firstgid].disposed=!1,s["mc"+u.firstgid].mapType=r):"normal"===c?s["mc"+u.firstgid].mapType=u.name:"start"===c&&(s["mc"+u.firstgid].mapType=r),!/^q_?$/i.test(u.name)&&i.indexOf(u.name)<0&&i.push(u.name))}for(var h=0;h<n.length;h++){var d=o.default.clone(s["mc"+n[h]]||{});if("normal"===d.type){!r&&(r=d.mapType);break}}for(var f=0;f<n.length;f++)if(0===n[f])t.push({type:"block",editable:!1});else{var m=o.default.clone(s["mc"+n[f]]||{});if("coin"===m.type)!m.mapType&&(m.mapType=r);else if("start"===m.type){m.type="normal";var p=f%k.default.mapSize[1],_=parseInt(f/k.default.mapSize[0]);k.default.startPosition=[_,p],!m.mapType&&(m.mapType=r)}t.push(m)}}return{mapData:t,sourceList:i}},showLoading:function(e){var t=document.querySelector(".game-container .game-loading");e?o.default.removeClass(t,"hide"):o.default.addClass(t,"hide")},showGame:function(e){var t=document.querySelector(".game-container .operate-container"),i=document.querySelector(".game-container .game-info"),a=document.querySelector(".game-container .game-notice");e?(o.default.removeClass(T.sceneCanvas,"hide"),o.default.removeClass(i,"hide"),o.default.removeClass(a,"hide"),o.default.removeClass(t,"hide")):(o.default.addClass(T.sceneCanvas,"hide"),o.default.addClass(i,"hide"),o.default.addClass(a,"hide"),o.default.addClass(t,"hide"))},refreshGameInfo:function(e,t){var i=b.default.get("game-score");i.endTime=(new Date).getTime();var a=i.base+i.food-i.move,n=document.querySelector(".game-container .game-info .score");n.innerText=a<0?0:a;var s=document.querySelector(".game-container .game-info .move");s.innerText=i.move;var r=document.querySelector(".game-container .game-info .food-name");if(i.lastFoodType){var l=k.default.filePath,u=b.default.get("assets-cache")[l+"assets/images/game/"+i.lastFoodType+".png"].assets;if(e){var c=[];c[0]=o.default.getElementLeft(r),c[1]=o.default.getElementTop(r);var h=window.devicePixelRatio||1,d=t[0]/h-c[0],f=t[1]/h-c[1];u.setAttribute("style",""),r.appendChild(u),setTimeout(function(){u.setAttribute("style","\n                        animation: flyToCoin 1s forwards;\n                        -moz-animation: flyToCoin 1s forwards;\n                        -webkit-animation: flyToCoin 1s forwards;\n                        -o-animation: flyToCoin 1s forwards;\n                        transform-origin: center bottom;\n                        -moz-transform-origin: center bottom;\n                        -webkit-transform-origin: center bottom;\n                        -o-transform-origin: center bottom;\n                        transform: matrix(1, 0, 0, 1, "+d+", "+f+");\n                        -webkit-transform: matrix(1, 0, 0, 1, "+d+", "+f+");\n                        -moz-transform: matrix(1, 0, 0, 1, "+d+", "+f+");\n                        -o-transform: matrix(1, 0, 0, 1, "+d+", "+f+");\n                    ")},10),T._cleanFoodIcon()}}else r.innerHTML="";var m=document.querySelector(".game-container .game-info .food");m.innerText=": "+i.food},refreshGameNotice:function(){var e=(document.querySelector(".game-container .game-notice .notice"),document.querySelector(".game-container .game-notice .refresh"));o.default.addClass(e,"center-rotate");b.default.get("map-info").mapID},_cleanFoodIcon:function(){setTimeout(function(){for(var e=document.querySelector(".game-container .game-info .food-name");e.children.length>1;)e.removeChild(e.querySelector("img"))},600)}};t.default=T},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(6),r=a(s),l=i(7),u=a(l),c=function(){function e(t){if(n(this,e),console.log("scene config",t),void 0===t)throw new Error("scene config required.");var i=[],a=t.mapSize[1]*t.startPosition[0]+t.startPosition[1];i[a]={type:r.default.ELE_TYPE_NORMAL,editable:!1,mapType:"Lot_Meadow"},this._map=new r.default(t.mapSize,t.blockCount,t.coinCount,i),this._role=new u.default(t.startPosition,t.startDirection),t.endPosition&&t.endPosition instanceof Array&&2===t.endPosition.length&&(this._endPos=t.endPosition,this._endDir=this._calcEndDir()),this._ended=!1,void 0!==t.mapData&&t.mapData instanceof Array&&(this._map.mapData=t.mapData)}return o(e,[{key:"roleMoveForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this._ended){var t=this._moveForward(e);if(t.direction=this._role.currentDirection,this._endPos)this._endDir?t.direction.join(",")===this._endDir.join(",")&&1===Math.abs(t.position[0]-this._endPos[0]+t.position[1]-this._endPos[1])&&(e>1||e>0&&!t.moved)&&(this._ended=!0,t.moved=!0,t.ended=!0,t.position=this._endPos):t.position.join(",")===this._endPosition.join(",")&&(this._ended=!0,t.ended=!0);else{for(var i=!0,a=0;a<this._map.mapData.length;a++){var n=this._map.mapData[a];if("coin"===n.type&&!n.disposed){i=!1;break}}i&&(this._ended=!0,t.ended=!0)}return t}return null}},{key:"roleTurnLeft",value:function(){if(!this._ended){this._role.turnLeft();var e=this._moveForward(0);return e.direction=this._role.currentDirection,e}return null}},{key:"roleTurnRight",value:function(){if(!this._ended){this._role.turnRight();var e=this._moveForward(0);return e.direction=this._role.currentDirection,e}return null}},{key:"_calcEndDir",value:function(){return this._endPos[0]<0?[0,-1]:this._endPos[0]>this._map.mapSize[0]-1?[0,1]:this._endPos[1]<0?[-1,0]:this._endPos[1]>this._map.mapSize[1]-1?[1,0]:null}},{key:"_moveForward",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!1,i=!1,a=!1,n=!1,o=!1,s=!1,l=!1,u=!1,c=this._role.currentPosition,h=this._role.currentDirection,d=this._map.mapSize,f=this._map.mapData,m=c.slice(),p=void 0,_=void 0,g=void 0,v=void 0;if("1,0"===h.join(",")){for(var y=c[1];y<=c[1]+e;y++)if(v=y-c[1],m[1]=y,m[1]>d[1]-1?(p={type:r.default.ELE_TYPE_EDGE},_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[1]>d[1]-2?(p=f[m[0]*d[1]+m[1]],_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[1]>d[1]-3?(p=f[m[0]*d[1]+m[1]],_=f[m[0]*d[1]+m[1]+1],g={type:r.default.ELE_TYPE_EDGE}):(p=f[m[0]*d[1]+m[1]],_=f[m[0]*d[1]+m[1]+1],g=f[m[0]*d[1]+m[1]+2]),p.type===r.default.ELE_TYPE_BLOCK||p.type===r.default.ELE_TYPE_EDGE){m[1]-=1;break}}else if("-1,0"===h.join(",")){for(var P=c[1];P>=c[1]-e;P--)if(v=c[1]-P,m[1]=P,m[1]<0?(p={type:r.default.ELE_TYPE_EDGE},_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[1]<1?(p=f[m[0]*d[1]+m[1]],_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[1]<2?(p=f[m[0]*d[1]+m[1]],_=f[m[0]*d[1]+m[1]-1],g={type:r.default.ELE_TYPE_EDGE}):(p=f[m[0]*d[1]+m[1]],_=f[m[0]*d[1]+m[1]-1],g=f[m[0]*d[1]+m[1]-2]),p.type===r.default.ELE_TYPE_BLOCK||p.type===r.default.ELE_TYPE_EDGE){m[1]+=1;break}}else if("0,-1"===h.join(",")){for(var E=c[0];E>=c[0]-e;E--)if(v=c[0]-E,m[0]=E,m[0]<0?(p={type:r.default.ELE_TYPE_EDGE},_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[0]<1?(p=f[m[0]*d[1]+m[1]],_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[0]<2?(p=f[m[0]*d[1]+m[1]],_=f[(m[0]-1)*d[1]+m[1]],g={type:r.default.ELE_TYPE_EDGE}):(p=f[m[0]*d[1]+m[1]],_=f[(m[0]-1)*d[1]+m[1]],g=f[(m[0]-2)*d[1]+m[1]]),p.type===r.default.ELE_TYPE_BLOCK||p.type===r.default.ELE_TYPE_EDGE){m[0]+=1;break}}else if("0,1"===h.join(","))for(var w=c[0];w<=c[0]+e;w++)if(v=w-c[0],m[0]=w,m[0]>d[0]-1?(p={type:r.default.ELE_TYPE_EDGE},_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[0]>d[0]-2?(p=f[m[0]*d[1]+m[1]],_={type:r.default.ELE_TYPE_EDGE},g={type:r.default.ELE_TYPE_EDGE}):m[0]>d[0]-3?(p=f[m[0]*d[1]+m[1]],_=f[(m[0]+1)*d[1]+m[1]],g={type:r.default.ELE_TYPE_EDGE}):(p=f[m[0]*d[1]+m[1]],_=f[(m[0]+1)*d[1]+m[1]],g=f[(m[0]+2)*d[1]+m[1]]),p.type===r.default.ELE_TYPE_BLOCK||p.type===r.default.ELE_TYPE_EDGE){m[0]-=1;break}return m.join(",")!==c.join(",")&&(t=!0,this._role.currentPosition=m),p.type===r.default.ELE_TYPE_EDGE?o=!0:p.type===r.default.ELE_TYPE_BLOCK?a=!0:(p.type===r.default.ELE_TYPE_COIN&&(l=!0,p.disposed=!0),_.type===r.default.ELE_TYPE_EDGE?o=!0:_.type===r.default.ELE_TYPE_BLOCK?a=!0:_.type===r.default.ELE_TYPE_COIN&&(u=!0),g.type===r.default.ELE_TYPE_EDGE?s=!0:g.type===r.default.ELE_TYPE_BLOCK&&(n=!0)),{moved:t,ended:i,blocked:a,willBlock:n,coined:l,willCoin:n,edged:o,willEdge:s,position:m,realStep:v}}},{key:"roleCurrentPosition",get:function(){return this._role.currentPosition}},{key:"roleCurrentDirection",get:function(){return this._role.currentDirection}},{key:"mapData",get:function(){return this._map.mapData}}]),e}();t.default=c},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(i(this,e),void 0===t)throw new Error("Please input mapsize.");if(!(t instanceof Array&&2===t.length))throw new Error("mapsize should be an array, length of 2.");this._mapSize=t,this._mapData=o,this._generateMapBlock(a),this._generateMapCoin(n)}return a(e,[{key:"_generateMapBlock",value:function(t){for(var i=[],a=0;a<this._mapSize[0]*this._mapSize[1];a++)this._mapData[a]&&void 0!==this._mapData[a].editable&&!this._mapData[a].editable||(i.push(a),this._mapData[a]={type:e.ELE_TYPE_NORMAL,editable:!0,mapType:"Lot_Meadow"});for(var n=[],o=0;o<t;o++)i.length>0&&n.push(i.splice(Math.floor(Math.random()*i.length),1).pop());for(var s=0;s<n.length;s++)this._mapData[n[s]]={type:e.ELE_TYPE_BLOCK,editable:!1}}},{key:"_generateMapCoin",value:function(t){for(var i=[],a=0;a<this._mapSize[0]*this._mapSize[1];a++)this._mapData[a]&&void 0!==this._mapData[a].editable&&!this._mapData[a].editable||i.push(a);for(var n=[],o=0;o<t;o++)i.length>0&&n.push(i.splice(Math.floor(Math.random()*i.length),1).pop());for(var s=0;s<n.length;s++)this._mapData[n[s]]={type:e.ELE_TYPE_COIN,coinType:["FOOD_Sausage","FOOD_Mushroom","FOOD_Cake"].splice(Math.floor(3*Math.random()),1).pop(),mapType:"Lot_Meadow",editable:!1,disposed:!1,coined:!1}}},{key:"mapSize",get:function(){return this._mapSize}},{key:"mapData",set:function(e){this._mapData=e},get:function(){return this._mapData}}],[{key:"ELE_TYPE_NORMAL",get:function(){return"normal"}},{key:"ELE_TYPE_BLOCK",get:function(){return"block"}},{key:"ELE_TYPE_COIN",get:function(){return"coin"}},{key:"ELE_TYPE_EDGE",get:function(){return"edge"}}]),e}();t.default=n},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=function(){function e(t,a){if(i(this,e),void 0===t)throw new Error("position required.");if(!(t instanceof Array)||2!==t.length)throw new Error("position invalid");if(this._currentPos=t,void 0===a)throw new Error("direction required.");if(!(a instanceof Array)||2!==a.length)throw new Error("direction invalid");this._currentDir=a}return a(e,[{key:"turnLeft",value:function(){var e=this._currentDir[1]||0,t=-this._currentDir[0]||0;this._currentDir=[e,t]}},{key:"turnRight",value:function(){var e=-this._currentDir[1]||0,t=this._currentDir[0]||0;this._currentDir=[e,t]}},{key:"currentPosition",get:function(){return this._currentPos},set:function(e){this._currentPos=e}},{key:"currentDirection",get:function(){return this._currentDir}}]),e}();t.default=n},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(3),r=a(s),l=i(9),u=a(l),c=function(){function e(t){if(n(this,e),void 0===t)throw new Error("lack of config");if(void 0===t.canvas)throw new Error("no canvas in config");if(this._canvas=t.canvas,void 0===t.topPoints)throw new Error("no topPoints in config");if(!(t.topPoints instanceof Array&&8===t.topPoints.length))throw new Error("topPoints in config should be an array, length at 8");if(this._topPoints=t.topPoints,!t.mapSize)throw new Error("no mapSize in config");if(this._mapSize=t.mapSize,!t.mapData)throw new Error("no mapData in config");this._mapData=t.mapData,t.endPosition&&t.endPosition instanceof Array&&2===t.endPosition.length&&(this._endPosition=t.endPosition),this._showGrid=t.showGrid||!1,this._cacheMap=void 0,this._endPosition&&(this._endImg=this._rectImage(r.default.get("assets-cache")[u.default.filePath+"assets/images/game/end.png"].assets))}return o(e,[{key:"render",value:function(){if(!this._cacheMap){this._cacheMap=document.createElement("canvas"),this._cacheMap.width=this._canvas.width,this._cacheMap.height=this._canvas.height;for(var e=this._cacheMap.getContext("2d"),t=this._topPoints[4].x-this._topPoints[0].x,i=this._topPoints[4].y-this._topPoints[0].y,a=this._topPoints[5].x-this._topPoints[1].x,n=this._topPoints[5].y-this._topPoints[1].y,o=this._topPoints[1].x-this._topPoints[0].x,s=this._topPoints[1].y-this._topPoints[0].y,l=this._topPoints[5].x-this._topPoints[4].x,c=this._topPoints[5].y-this._topPoints[4].y,h=this._topPoints[2].x-this._topPoints[3].x,d=this._topPoints[2].y-this._topPoints[3].y,f=this._topPoints[6].x-this._topPoints[2].x,m=this._topPoints[6].y-this._topPoints[2].y,p=this._topPoints[0].y,_=this._topPoints[0].y,g=1;g<this._topPoints.length;g++)p=Math.min(p,this._topPoints[g].y),_=Math.max(_,this._topPoints[g].y);for(var v=.5*(p+_),y=this._cacheMap.width,P=this._cacheMap.height,E=Math.abs(-t/this._mapSize[0]-l/this._mapSize[1]),w=0;w<this._mapSize[0];w++)for(var b=this._topPoints[0].x+t*(this._mapSize[0]-w)/this._mapSize[0],S=this._topPoints[0].y+i*(this._mapSize[0]-w)/this._mapSize[0],k=this._topPoints[1].x+a*(this._mapSize[0]-w)/this._mapSize[0],T=this._topPoints[1].y+n*(this._mapSize[0]-w)/this._mapSize[0],z=k-b,C=T-S,M=0;M<this._mapSize[1];M++){var D=this._mapData[w*this._mapSize[1]+M].type;if(void 0!==D&&"block"===D);else if(this._endPosition&&w===this._endPosition[0]&&M===this._endPosition[1])e.drawImage(this._endImg,b+z*M/this._mapSize[1]-.5*E+.5*y,S+C*M/this._mapSize[1]-v+.5*P-4,E+0,E);else{var L=this._mapData[w*this._mapSize[1]+M].mapType,x=r.default.get("assets-cache")[u.default.filePath+"assets/images/game/"+L+".png"],A=x&&x.assets;A&&e.drawImage(this._rectImage(A),b+z*M/this._mapSize[1]-.5*E+.5*y,S+C*M/this._mapSize[1]-v+.5*P-4,E+0,E)}}if(this._endPosition&&(this._endPosition[0]<0||this._endPosition[0]>this._mapSize[0]-1||this._endPosition[1]<0||this._endPosition[1]>this._mapSize[1]-1)){var I=this._topPoints[4].x+-t*this._endPosition[0]/this._mapSize[0],j=this._topPoints[4].y+-i*this._endPosition[0]/this._mapSize[0],G=this._topPoints[5].x+-a*this._endPosition[0]/this._mapSize[0],O=this._topPoints[5].y+-n*this._endPosition[0]/this._mapSize[0],Y=G-I,R=O-j,q=I+Y*this._endPosition[1]/this._mapSize[1],F=j+R*this._endPosition[1]/this._mapSize[1],B=Math.abs(-t/this._mapSize[0]-l/this._mapSize[1]);e.drawImage(this._endImg,q-.5*B+.5*y,F-v+.5*P-4,B,B)}if(this._showGrid){e.strokeStyle="red",e.lineWidth=2,e.beginPath();for(var N=0;N<=this._mapSize[0];N++)e.moveTo(this._topPoints[0].x+t*N/this._mapSize[0]+.5*y,this._topPoints[0].y+i*N/this._mapSize[0]-v+.5*P),e.lineTo(this._topPoints[1].x+a*N/this._mapSize[0]+.5*y,this._topPoints[1].y+n*N/this._mapSize[0]-v+.5*P);for(var H=0;H<=this._mapSize[1];H++)e.moveTo(this._topPoints[0].x+o*H/this._mapSize[1]+.5*y,this._topPoints[0].y+s*H/this._mapSize[1]-v+.5*P),e.lineTo(this._topPoints[4].x+l*H/this._mapSize[1]+.5*y,this._topPoints[4].y+c*H/this._mapSize[1]-v+.5*P);e.moveTo(this._topPoints[3].x+.5*y,this._topPoints[3].y-v+.5*P),e.lineTo(this._topPoints[2].x+.5*y,this._topPoints[2].y-v+.5*P);for(var K=0;K<=this._mapSize[1];K++)e.moveTo(this._topPoints[0].x+o*K/this._mapSize[1]+.5*y,this._topPoints[0].y+s*K/this._mapSize[1]-v+.5*P),e.lineTo(this._topPoints[3].x+h*K/this._mapSize[1]+.5*y,this._topPoints[3].y+d*K/this._mapSize[1]-v+.5*P);e.moveTo(this._topPoints[2].x+.5*y,this._topPoints[2].y-v+.5*P),e.lineTo(this._topPoints[6].x+.5*y,this._topPoints[6].y-v+.5*P);for(var U=0;U<=this._mapSize[0];U++)e.moveTo(this._topPoints[1].x+a*U/this._mapSize[0]+.5*y,this._topPoints[1].y+n*U/this._mapSize[0]-v+.5*P),e.lineTo(this._topPoints[2].x+f*U/this._mapSize[0]+.5*y,this._topPoints[2].y+m*U/this._mapSize[0]-v+.5*P);e.stroke()}}var W=this._canvas.getContext("2d");W.drawImage(this._cacheMap,0,100,this._canvas.width,this._canvas.height)}},{key:"_rectImage",value:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),a=Math.max(e.width,e.height);t.width=a,t.height=a;var n=.5*(a-e.width),o=.5*(a-e.height);return i.drawImage(e,n,o,e.width,e.height),t}}]),e}();t.default=c},,function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(2),r=a(s),l=i(11),u=a(l),c=function(){function e(t){if(n(this,e),void 0===t)throw new Error("lack of config");if(void 0===t.canvas)throw new Error("no canvas in config");if(this._canvas=t.canvas,void 0===t.topPoints)throw new Error("no topPoints in config");if(!(t.topPoints instanceof Array&&8===t.topPoints.length))throw new Error("topPoints in config should be an array, length at 8");if(this._topPoints=t.topPoints,!t.mapSize)throw new Error("no mapSize in config");this._mapSize=t.mapSize,t.startPosition&&(this._pos=t.startPosition),t.startDirection&&(this._dir=t.startDirection),this._showGrid=t.showGrid||!1,this._roleAnimate=new u.default,this._roleAnimate.turnToRight(),this._cacheAnimateImg={}}return o(e,[{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pos,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dir,a=void 0;if(i.join(",")!==this._dir.join(",")&&(this._dir=i,"1,0"===i.join(",")?this._roleAnimate.turnToRight():"-1,0"===i.join(",")?this._roleAnimate.turnToLeft():"0,-1"===i.join(",")?this._roleAnimate.turnToTop():"0,1"===i.join(",")&&this._roleAnimate.turnToBottom()),t.join(",")!==this._pos.join(",")){0===e?this._roleAnimate.play():1===e?this._pos=t:e===-1&&(this._roleAnimate.stop(),this._pos=t);var n=this._getRoleCoord(this._pos),o=this._getRoleCoord(t),s=o[0]-n[0],l=o[1]-n[1],u=n[0]+s*e,c=n[1]+l*e;a=[u,c]}else a=this._getRoleCoord(this._pos),e===-1&&(this._roleAnimate.stop(),this._pos=t);for(var h=this._topPoints[0].x-this._topPoints[4].x,d=this._topPoints[0].y-this._topPoints[4].y,f=this._topPoints[1].x-this._topPoints[5].x,m=this._topPoints[1].y-this._topPoints[5].y,p=this._topPoints[5].x-this._topPoints[4].x,_=this._topPoints[0].y,g=this._topPoints[0].y,v=1;v<this._topPoints.length;v++)_=Math.min(_,this._topPoints[v].y),
g=Math.max(g,this._topPoints[v].y);var y=.5*(_+g);if(this._showGrid)for(var P=0;P<this._mapSize[0];P++)for(var E=0;E<this._mapSize[1];E++){var w=this._topPoints[4].x+h*(P+.5)/this._mapSize[0],b=this._topPoints[4].y+d*(P+.5)/this._mapSize[0],S=this._topPoints[5].x+f*(P+.5)/this._mapSize[0],k=this._topPoints[5].y+m*(P+.5)/this._mapSize[0],T=S-w,z=k-b,C=w+T*(E+.5)/this._mapSize[1],M=b+z*(E+.5)/this._mapSize[1];D.fillStyle="red",D.beginPath(),D.arc(C+.5*L,M-y+.5*x,4,0,2*Math.PI),D.closePath(),D.fill()}var D=this._canvas.getContext("2d"),L=this._canvas.width,x=this._canvas.height,A=this._roleAnimate.animateImage,I=this._getCacheAnimateImg(A),j=void 0;if(I)j=I;else{var G=this._rectImage(A);this._cacheAnimateImg[r.default.makeSimpleGUID()]={img:A,cvs:G},j=G}var O=1.4*Math.abs(h/this._mapSize[0]-p/this._mapSize[1]);D.drawImage(j,a[0]-.5*O+.5*L,a[1]-O-y+.5*x+105,O,O)}},{key:"_getCacheAnimateImg",value:function(e){for(var t in this._cacheAnimateImg)if(this._cacheAnimateImg[t]&&this._cacheAnimateImg[t].img===e)return this._cacheAnimateImg[t].cvs;return null}},{key:"_getRoleCoord",value:function(e){var t=this._topPoints[0].x-this._topPoints[4].x,i=this._topPoints[0].y-this._topPoints[4].y,a=this._topPoints[1].x-this._topPoints[5].x,n=this._topPoints[1].y-this._topPoints[5].y,o=(this._topPoints[5].x-this._topPoints[4].x,this._topPoints[4].x+t*(e[0]+.5)/this._mapSize[0]),s=this._topPoints[4].y+i*(e[0]+.5)/this._mapSize[0],r=this._topPoints[5].x+a*(e[0]+.5)/this._mapSize[0],l=this._topPoints[5].y+n*(e[0]+.5)/this._mapSize[0],u=r-o,c=l-s,h=o+u*(e[1]+.5)/this._mapSize[1],d=s+c*(e[1]+.5)/this._mapSize[1];return[h,d]}},{key:"_rectImage",value:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),a=Math.max(e.width,e.height);t.width=a,t.height=a;var n=.5*(a-e.width),o=.5*(a-e.height);return i.drawImage(e,n,o,e.width,e.height),t}}]),e}();t.default=c},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(12),r=a(s),l=i(3),u=a(l),c=i(9),h=a(c),d=function(){function e(){n(this,e),this._leftAnimate=void 0,this._topAnimate=void 0,this._rightAnimate=void 0,this._bottomAnimate=void 0,this._currentAnimate=void 0,this._generateAnimates()}return o(e,[{key:"play",value:function(){this._currentAnimate.play()}},{key:"stop",value:function(){this._currentAnimate.stop()}},{key:"turnToRight",value:function(){this._currentAnimate=this._rightAnimate,this._currentAnimate.stop()}},{key:"turnToTop",value:function(){this._currentAnimate=this._topAnimate,this._currentAnimate.stop()}},{key:"turnToLeft",value:function(){this._currentAnimate=this._leftAnimate,this._currentAnimate.stop()}},{key:"turnToBottom",value:function(){this._currentAnimate=this._bottomAnimate,this._currentAnimate.stop()}},{key:"_generateAnimates",value:function(){var e=50,t=u.default.get("assets-cache"),i=[[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7],[8,8],[9,9]],a=[{range:i[0],image:t[h.default.filePath+"assets/images/game/role/left/20001.png"].assets},{range:i[1],image:t[h.default.filePath+"assets/images/game/role/left/20002.png"].assets},{range:i[2],image:t[h.default.filePath+"assets/images/game/role/left/20003.png"].assets},{range:i[3],image:t[h.default.filePath+"assets/images/game/role/left/20004.png"].assets},{range:i[4],image:t[h.default.filePath+"assets/images/game/role/left/20005.png"].assets},{range:i[5],image:t[h.default.filePath+"assets/images/game/role/left/20006.png"].assets},{range:i[6],image:t[h.default.filePath+"assets/images/game/role/left/20007.png"].assets},{range:i[7],image:t[h.default.filePath+"assets/images/game/role/left/20008.png"].assets},{range:i[8],image:t[h.default.filePath+"assets/images/game/role/left/20009.png"].assets},{range:i[9],image:t[h.default.filePath+"assets/images/game/role/left/20010.png"].assets}],n=t[h.default.filePath+"assets/images/game/role/stop/left_stop.png"].assets;this._leftAnimate=new r.default(e,a,n);var o=[{range:i[0],image:t[h.default.filePath+"assets/images/game/role/top/10001.png"].assets},{range:i[1],image:t[h.default.filePath+"assets/images/game/role/top/10002.png"].assets},{range:i[2],image:t[h.default.filePath+"assets/images/game/role/top/10003.png"].assets},{range:i[3],image:t[h.default.filePath+"assets/images/game/role/top/10004.png"].assets},{range:i[4],image:t[h.default.filePath+"assets/images/game/role/top/10005.png"].assets},{range:i[5],image:t[h.default.filePath+"assets/images/game/role/top/10006.png"].assets},{range:i[6],image:t[h.default.filePath+"assets/images/game/role/top/10007.png"].assets},{range:i[7],image:t[h.default.filePath+"assets/images/game/role/top/10008.png"].assets},{range:i[8],image:t[h.default.filePath+"assets/images/game/role/top/10009.png"].assets},{range:i[9],image:t[h.default.filePath+"assets/images/game/role/top/10010.png"].assets}],s=t[h.default.filePath+"assets/images/game/role/stop/top_stop.png"].assets;this._topAnimate=new r.default(e,o,s);var l=[{range:i[0],image:t[h.default.filePath+"assets/images/game/role/right/30001.png"].assets},{range:i[1],image:t[h.default.filePath+"assets/images/game/role/right/30002.png"].assets},{range:i[2],image:t[h.default.filePath+"assets/images/game/role/right/30003.png"].assets},{range:i[3],image:t[h.default.filePath+"assets/images/game/role/right/30004.png"].assets},{range:i[4],image:t[h.default.filePath+"assets/images/game/role/right/30005.png"].assets},{range:i[5],image:t[h.default.filePath+"assets/images/game/role/right/30006.png"].assets},{range:i[6],image:t[h.default.filePath+"assets/images/game/role/right/30007.png"].assets},{range:i[7],image:t[h.default.filePath+"assets/images/game/role/right/30008.png"].assets},{range:i[8],image:t[h.default.filePath+"assets/images/game/role/right/30009.png"].assets},{range:i[9],image:t[h.default.filePath+"assets/images/game/role/right/30010.png"].assets}],c=t[h.default.filePath+"assets/images/game/role/stop/right_stop.png"].assets;this._rightAnimate=new r.default(e,l,c);var d=[{range:i[0],image:t[h.default.filePath+"assets/images/game/role/bottom/40001.png"].assets},{range:i[1],image:t[h.default.filePath+"assets/images/game/role/bottom/40002.png"].assets},{range:i[2],image:t[h.default.filePath+"assets/images/game/role/bottom/40003.png"].assets},{range:i[3],image:t[h.default.filePath+"assets/images/game/role/bottom/40004.png"].assets},{range:i[4],image:t[h.default.filePath+"assets/images/game/role/bottom/40005.png"].assets},{range:i[5],image:t[h.default.filePath+"assets/images/game/role/bottom/40006.png"].assets},{range:i[6],image:t[h.default.filePath+"assets/images/game/role/bottom/40007.png"].assets},{range:i[7],image:t[h.default.filePath+"assets/images/game/role/bottom/40008.png"].assets},{range:i[8],image:t[h.default.filePath+"assets/images/game/role/bottom/40009.png"].assets},{range:i[9],image:t[h.default.filePath+"assets/images/game/role/bottom/40010.png"].assets}],f=t[h.default.filePath+"assets/images/game/role/stop/bottom_stop.png"].assets;this._bottomAnimate=new r.default(e,d,f)}},{key:"animateImage",get:function(){return this._currentAnimate.currentImage}}]),e}();t.default=d},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(2),r=a(s),l=function(){function e(t,i,a){var o=this;n(this,e),this._fps=t,this._frameList=i,this._currentFrame=-1,this._timeStamp=0,this._frameID=0,this._loop=!1,this._playing=!1,this._stopimg=a,this._MAX_FRAME=function(){for(var e=0,t=0;t<o._frameList.length;t++)e=Math.max(e,o._frameList[t].range[1]);return e}()}return o(e,[{key:"play",value:function(e){var t=this;this._loop=!0,this._playing=!0,this._currentFrame=0;var i=function e(i){0===t._timeStamp?t._timeStamp=i:i-t._timeStamp>1e3/t._fps&&(t._timeStamp=i,t._currentFrame+=1,t._currentFrame>=t._MAX_FRAME&&(t._currentFrame=0)),t._playing&&t._loop&&(t._frameID=r.default.requestAnimFrame.call(null,e))};this._frameID=r.default.requestAnimFrame.call(null,i)}},{key:"pause",value:function(e){this._loop=!1,this._playing=!1}},{key:"stop",value:function(){this._loop=!1,this._currentFrame=-1,this._timeStamp=0,this._frameID=0,this._playing=!1}},{key:"currentImage",get:function(){if(this._playing===!1&&this._currentFrame<0)return this._stopimg||"stop";for(var e=0;e<this._frameList.length;e++)if(this._currentFrame>=this._frameList[e].range[0]&&this._currentFrame<=this._frameList[e].range[1])return this._frameList[e].image;return null}}]),e}();t.default=l},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(3),r=a(s),l=i(9),u=a(l),c=function(){function e(t){if(n(this,e),void 0===t)throw new Error("lack of config");if(void 0===t.canvas)throw new Error("no canvas in config");if(this._canvas=t.canvas,void 0===t.topPoints)throw new Error("no topPoints in config");if(!(t.topPoints instanceof Array&&8===t.topPoints.length))throw new Error("topPoints in config should be an array, length at 8");if(this._topPoints=t.topPoints,!t.mapSize)throw new Error("no mapSize in config");this._mapSize=t.mapSize,this._cacheCoinImg={}}return o(e,[{key:"getCoinCoord",value:function(e){for(var t=this._topPoints[0].x-this._topPoints[4].x,i=this._topPoints[0].y-this._topPoints[4].y,a=this._topPoints[1].x-this._topPoints[5].x,n=this._topPoints[1].y-this._topPoints[5].y,o=this._topPoints[5].x-this._topPoints[4].x,s=this._topPoints[0].y,r=this._topPoints[0].y,l=1;l<this._topPoints.length;l++)s=Math.min(s,this._topPoints[l].y),r=Math.max(r,this._topPoints[l].y);for(var u=.5*(s+r),c=(this._canvas.getContext("2d"),this._canvas.width),h=this._canvas.height,d=.8*Math.abs(t/this._mapSize[0]-o/this._mapSize[1]),f=0;f<this._mapSize[0];f++)for(var m=0;m<this._mapSize[1];m++)if(f===e[0]&&m===e[1]){var p=this._topPoints[4].x+t*(f+.5)/this._mapSize[0],_=this._topPoints[4].y+i*(f+.5)/this._mapSize[0],g=this._topPoints[5].x+a*(f+.5)/this._mapSize[0],v=this._topPoints[5].y+n*(f+.5)/this._mapSize[0],y=g-p,P=v-_,E=p+y*(m+.5)/this._mapSize[1],w=_+P*(m+.5)/this._mapSize[1];return[E-.5*d+.5*c,w-d-u+.5*h+.25*d+100]}}},{key:"render",value:function(e,t,i){if(!(e instanceof Array&&e.length===this._mapSize[0]*this._mapSize[1]))throw new Error("render data should be an array, length same as mapdata");for(var a=this._topPoints[0].x-this._topPoints[4].x,n=this._topPoints[0].y-this._topPoints[4].y,o=this._topPoints[1].x-this._topPoints[5].x,s=this._topPoints[1].y-this._topPoints[5].y,l=this._topPoints[5].x-this._topPoints[4].x,c=this._topPoints[0].y,h=this._topPoints[0].y,d=1;d<this._topPoints.length;d++)c=Math.min(c,this._topPoints[d].y),h=Math.max(h,this._topPoints[d].y);for(var f=.5*(c+h),m=this._canvas.getContext("2d"),p=this._canvas.width,_=this._canvas.height,g=t[0]+t[1],v=.8*Math.abs(a/this._mapSize[0]-l/this._mapSize[1]),y=0;y<this._mapSize[0];y++)for(var P=0;P<this._mapSize[1];P++)if("up"===i&&P<g-y||"down"===i&&P>=g-y){var E=e[y*this._mapSize[0]+P];if("coin"===E.type&&!E.disposed){var w=this._topPoints[4].x+a*(y+.5)/this._mapSize[0],b=this._topPoints[4].y+n*(y+.5)/this._mapSize[0],S=this._topPoints[5].x+o*(y+.5)/this._mapSize[0],k=this._topPoints[5].y+s*(y+.5)/this._mapSize[0],T=S-w,z=k-b,C=w+T*(P+.5)/this._mapSize[1],M=b+z*(P+.5)/this._mapSize[1],D=u.default.filePath+"assets/images/game/"+E.coinType+".png",L=this._getCacheCoinImg(D);if(!L){var x=r.default.get("assets-cache")[D],A=x.assets;A&&(this._cacheCoinImg[D]=this._rectImage(A),L=this._cacheCoinImg[D])}L&&m.drawImage(L,C-.5*v+.5*p,M-v-f+.5*_+.25*v+100,v,v)}}}},{key:"_getCacheCoinImg",value:function(e){for(var t in this._cacheCoinImg)if(t===e)return this._cacheCoinImg[t];return null}},{key:"_rectImage",value:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),a=Math.max(e.width,e.height);t.width=a,t.height=a;var n=.5*(a-e.width),o=.5*(a-e.height);return i.drawImage(e,n,o,e.width,e.height),t}}]),e}();t.default=c},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=function(){function e(t,a,n){i(this,e),this._x=t,this._y=a,this._z=n}return a(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}}]),e}();t.default=n},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(14),r=a(s),l=i(16),u=a(l),c=i(17),h=a(c),d=function(){function e(t,i,a){n(this,e),this._vpoint=t,this._vangle=i,this._f=a}return o(e,[{key:"projectPoints",value:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.projectPoint(e[i]));return t}},{key:"projectPoint",value:function(e){var t=this._vpoint,i=this._vangle,a=[[1,0,0],[0,Math.cos(-i.x),-Math.sin(-i.x)],[0,Math.sin(-i.x),Math.cos(-i.x)]],n=[[Math.cos(-i.y),0,Math.sin(-i.y)],[0,1,0],[-Math.sin(-i.y),0,Math.cos(-i.y)]],o=[[Math.cos(-i.z),-Math.sin(-i.z),0],[Math.sin(-i.z),Math.cos(-i.z),0],[0,0,1]],s=h.default.multiply(h.default.multiply(h.default.multiply(a,n),o),[[e.x-t.x],[e.y-t.y],[e.z-t.z]]),l=new r.default(s[0][0],s[1][0],s[2][0]);return new u.default(l.x,l.y)}}]),e}();t.default=d},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=function(){function e(t,a){i(this,e),this._x=t,this._y=a}return a(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),e}();t.default=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};i.transpose=function(e){for(var t=new Array(e[0].length),i=0;i<e[0].length;i++){t[i]=new Array(e.length);for(var a=0;a<e.length;a++)t[i][a]=e[a][i]}return t},i.multiply=function(e,t){if(e[0].length!==t.length)throw new Error("Matrix mismatch");for(var a=new Array(e.length),n=0;n<e.length;n++)a[n]=new Array(t[0].length);for(var o=i.transpose(t),s=0;s<a.length;s++)for(var r=0;r<a[s].length;r++)a[s][r]=i.dotproduct(e[s],o[r]);return a},i.dotproduct=function(e,t){if(e.length!==t.length)throw new Error("Vector mismatch");for(var i=0,a=0;a<e.length;a++)i+=e[a]*t[a];return i},t.default=i},function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=i(2),r=a(s),l=function(){function e(t){n(this,e),this._name=t.name,this._url=t.url,this._callback=t.callback,this.__callback=t._callback,this._loaded=!1,this._audio=void 0}return o(e,[{key:"load",value:function(){var e=document.createElement("audio");e.src=this._url,this._loaded=!0,"function"==typeof this._callback&&this._callback(this),this._audio=e}},{key:"sourceLoaded",get:function(){return this._loaded}},{key:"sourceName",get:function(){return this._name}},{key:"sourceURL",get:function(){return this._url}},{key:"sourceCallback",get:function(){return this.__callback}},{key:"sourceAssets",get:function(){return this._audio}}]),e}(),u=function(){function e(t){n(this,e),this._name=t.name,this._url=t.url,this._callback=t.callback,this.__callback=t._callback,this._loaded=!1,this._img=void 0}return o(e,[{key:"load",value:function(){var e=this,t=document.createElement("img");t.src=this._url,t.onload=function(t){e._loaded=!0,"function"==typeof e._callback&&e._callback(e)}.bind(this),this._img=t}},{key:"sourceLoaded",get:function(){return this._loaded}},{key:"sourceName",get:function(){return this._name}},{key:"sourceURL",get:function(){return this._url}},{key:"sourceCallback",get:function(){return this.__callback}},{key:"sourceAssets",get:function(){return this._img}}]),e}(),c=function(){function e(t){if(n(this,e),!(t instanceof Array))throw new Error("source should be an array list");this._source=t,this._sourceList=[],this._callback=void 0,this._progress=void 0}return o(e,[{key:"load",value:function(e){"function"==typeof e&&(this._callback=e);for(var t=[],i=0;i<this._source.length;i++){var a=void 0,n=void 0;n="string"==typeof this._source[i]?this._source[i]:this._source[i].url,/.(WAV|MP3|WMA|RA|APE|AAC)$/i.test(n)?a="audio":/.(JPE?G|TIFF|RAW|BMP|GIF|PNG)$/i.test(n)&&(a="image");var o=void 0;o="string"==typeof this._source[i]?{name:r.default.makeSimpleGUID,url:n,callback:this._loadedHandler.bind(this)}:{name:this._source[i].name||r.default.makeSimpleGUID(),url:n,callback:this._loadedHandler.bind(this),_callback:this._source[i].callback},"audio"===a?t.push(new l(o)):"image"===a&&t.push(new u(o))}this._sourceList=t;for(var s=0;s<this._sourceList.length;s++)this._sourceList[s].load()}},{key:"_loadedHandler",value:function(e){var t=this._getSource(e.name);t&&"function"==typeof t.sourceCallback&&t.sourceCallback(t.sourceAssets);for(var i=[],a=0;a<this._sourceList.length;a++)this._sourceList[a].sourceLoaded&&i.push({url:this._sourceList[a].sourceURL,assets:this._sourceList[a].sourceAssets});var n=this._getProgress();n.loadedList=i,"function"==typeof this._callback&&this._callback(n)}},{key:"_getSource",value:function(e){for(var t=0;t<this._sourceList.length;t++)if(this._sourceList[t].sourceName===e)return this._sourceList[t];return null}},{key:"_getProgress",value:function(){for(var e={totalCount:this._sourceList.length,loadedCount:0,complete:!1},t=0;t<this._sourceList.length;t++)this._sourceList[t].sourceLoaded&&(e.loadedCount+=1);return e.totalCount===e.loadedCount&&(e.complete=!0),e}}]),e}();t.default=c},function(e,t){},,,,,,,,function(e,t){}]);